---
layout: post
title: Javac编译与JIT编译
category: JVM
tags: JVM
keywords: JVM
---
## Javac编译
- Java文件转化为Class文件，Javac编译入口：com.sun.tools.javac.main.JavaCompiler类

### 解析与填充符号表
1. 词法，语法分析-com.sun.tools.javac.parser.Scanner
	- 将源代码的字符流转变为标记集合，单个字符是程序编写过程的最小元素，标记是编译过程的最小元素
2. 填充符号表-com.sun.tools.javac.comp.Enter
	- 符号表是由一组符号地址和符号信息构成的表格

### 注解处理器
- jdk1.6之后提供了插入式注解处理器的标准API在编译期间对注解进行处理

### 语义分析与字节码生成
1. 标注检查-com.sun.tools.javac.comp.Attr 和 com.sun.tools.javac.comp.Check
	- 检查包括变量使用前是否已被声明，变量与赋值之间的数据类型是否能够匹配等
2. 数据及控制流分析
	- 进一步对程序上下文逻辑的验证，检查包括程序局部变量在使用前是否有赋值，方法的每条路径是否都有返回值等
3. 解语法糖(语法糖：在计算机语言中添加的某种语法，这种语法对语言的功能并没有影响，但更方便程序员使用)-com.sun.tools.comp.TransTypes 和com.sun.tools.javac.comp.Lower
	1. 泛型与类型擦除：Java泛型只存在程序源码中，编译后的字节码文件中，已经替换为原生类型
	2. 自动装箱，拆箱与遍历循环
	3. 条件编译
4. 字节码生成 -com.sun.tools.javac.jvm.Gen
- 不只把前面各阶段生成的信息转化为字节码写入磁盘，还进行了少量的代码添加和转换工作（实例构造器<init>和<clinit>方法的生成

## JIT编译优化
- JIT编译器将热点代码编译成与平台相关的机器码，并进行多层次的优化
- 编译对象
	1. 被多次调用的方法-OSR编译
	2. 被多次执行的循环体
- 触发条件-达成热点代码的探测方式
	1. 基于采样的热点探测-周期性地检查各个线程地栈顶
	2. 基于计数器的热点探测-为每个方法（甚至是代码块）建立计数器，统计方法地执行次数，执行次数超过一定地阈值即热点方法
- 优化技术
	1. 公共子表达式消除：如果一个表达式E已经计算过了，并且从先前地计算到现在E中所有变量地值都没有发生变化，那么E地这次出现就成为了公共子表达式
	2. 数组边界检查消除
	3. 方法内联
	4. 逃逸分析：分析对象动态作用域，用于其他技术进行优化
		1. 栈上分配：确定对象不会逃逸出方法之外，那么该对象分配到栈上更高效
		2. 同步消除：同步块不会被其他线程访问，同步措施可以消除
		3. 标量替换：一个对象不会被外部访问，并且该对象可以被拆散，则可以将使用到地成员变量替换成标量（无法再分解地原始数据类型）
## 参考
- 深入理解Java虚拟机








 


	





 

